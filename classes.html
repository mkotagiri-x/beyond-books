<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Classes - Beyond Books</title>
  <meta name="robots" content="noindex, nofollow" />
  <meta name="theme-color" content="#6c3ce0" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <link rel="icon" type="image/svg+xml" href="assets/logo-icon.svg" />
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary: #6c3ce0;
      --primary-light: #a78bfa;
      --accent: #ec4899;
      --dark: #0f0a1a;
      --light: #f8f6ff;
      --glass: rgba(255,255,255,0.06);
      --glass-border: rgba(255,255,255,0.10);
      --radius: 20px;
    }

    body {
      font-family: 'Space Grotesk', sans-serif;
      background: var(--dark);
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
    }

    body::before, body::after {
      content: '';
      position: fixed;
      border-radius: 50%;
      filter: blur(120px);
      opacity: 0.3;
      z-index: 0;
    }
    body::before {
      width: 500px; height: 500px;
      background: var(--primary);
      top: -100px; left: -100px;
    }
    body::after {
      width: 400px; height: 400px;
      background: var(--accent);
      bottom: -100px; right: -100px;
    }

    .page-wrap {
      position: relative;
      z-index: 1;
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 40px;
    }
    .header .logo-img {
      height: 48px;
      margin-bottom: 16px;
    }
    .header h1 {
      font-family: 'Outfit', sans-serif;
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 8px;
    }
    .header h1 span {
      background: linear-gradient(135deg, var(--primary-light), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .header p {
      color: rgba(255,255,255,0.5);
      font-size: 0.95rem;
    }

    /* === GATE === */
    .gate {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
      text-align: center;
    }
    .gate-icon {
      font-size: 64px;
      margin-bottom: 24px;
    }
    .gate h2 {
      font-family: 'Outfit', sans-serif;
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .gate p {
      color: rgba(255,255,255,0.5);
      margin-bottom: 30px;
      font-size: 0.95rem;
    }
    .gate-form {
      display: flex;
      gap: 12px;
      width: 100%;
      max-width: 400px;
    }
    .gate-input {
      flex: 1;
      padding: 14px 20px;
      border: 2px solid var(--glass-border);
      border-radius: 14px;
      background: var(--glass);
      color: #fff;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1rem;
      letter-spacing: 4px;
      text-align: center;
      text-transform: uppercase;
      outline: none;
      transition: border-color 0.3s;
    }
    .gate-input::placeholder {
      letter-spacing: 1px;
      color: rgba(255,255,255,0.3);
    }
    .gate-input:focus {
      border-color: var(--primary);
    }
    .gate-btn {
      padding: 14px 28px;
      border: none;
      border-radius: 14px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: #fff;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .gate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(108,60,224,0.4);
    }
    .gate-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    .gate-error {
      color: #f87171;
      font-size: 0.9rem;
      margin-top: 14px;
      display: none;
    }
    .help-link {
      text-align: center;
      margin-top: 20px;
    }
    .help-link a {
      color: rgba(255,255,255,0.3);
      text-decoration: none;
      font-size: 0.85rem;
    }
    .help-link a:hover {
      color: var(--primary-light);
    }

    /* === CLASSES === */
    .classes {
      display: none;
    }
    .classes.visible {
      display: block;
      animation: fadeUp 0.5s ease;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .welcome-bar {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      padding: 20px 28px;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }
    .welcome-bar .welcome-text {
      font-size: 0.95rem;
      color: rgba(255,255,255,0.6);
    }
    .welcome-bar .welcome-text strong {
      color: #fff;
      font-size: 1.1rem;
    }
    .welcome-bar .welcome-code {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.3);
      margin-top: 4px;
    }
    .logout-btn {
      padding: 8px 20px;
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 10px;
      background: transparent;
      color: rgba(255,255,255,0.5);
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .logout-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* Course card */
    .class-card {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      padding: 32px;
      display: flex;
      align-items: center;
      gap: 24px;
      transition: transform 0.2s, border-color 0.2s;
    }
    .class-card:hover {
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.2);
    }
    .class-icon {
      width: 64px;
      height: 64px;
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      flex-shrink: 0;
    }
    .class-icon.art { background: linear-gradient(135deg, #f472b6, #ec4899); }
    .class-icon.chess { background: linear-gradient(135deg, #34d399, #059669); }
    .class-icon.dance { background: linear-gradient(135deg, #a78bfa, #7c3aed); }
    .class-icon.music { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
    .class-icon.abacus { background: linear-gradient(135deg, #38bdf8, #0284c7); }

    .class-info {
      flex: 1;
    }
    .class-info h3 {
      font-family: 'Outfit', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .class-info p {
      color: rgba(255,255,255,0.4);
      font-size: 0.9rem;
    }

    .join-btn {
      padding: 14px 32px;
      border: none;
      border-radius: 14px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: #fff;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: transform 0.2s, box-shadow 0.2s;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .join-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(108,60,224,0.4);
    }

    /* Info note */
    .info-note {
      background: rgba(251, 191, 36, 0.08);
      border: 1px solid rgba(251, 191, 36, 0.2);
      border-radius: var(--radius);
      padding: 20px 28px;
      margin-top: 24px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
      font-size: 0.9rem;
      color: rgba(255,255,255,0.6);
      line-height: 1.6;
    }
    .info-note span {
      font-size: 20px;
      flex-shrink: 0;
    }

    /* No class message */
    .no-class {
      text-align: center;
      padding: 40px 20px;
      color: rgba(255,255,255,0.4);
    }
    .no-class h3 {
      font-family: 'Outfit', sans-serif;
      font-size: 1.2rem;
      color: rgba(255,255,255,0.6);
      margin-bottom: 8px;
    }

    /* Footer */
    .page-footer {
      text-align: center;
      margin-top: 50px;
      padding-top: 24px;
      border-top: 1px solid var(--glass-border);
      color: rgba(255,255,255,0.3);
      font-size: 0.85rem;
    }
    .page-footer a {
      color: var(--primary-light);
      text-decoration: none;
    }

    /* Loading spinner */
    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(255,255,255,0.2);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      display: inline-block;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (max-width: 600px) {
      .class-card {
        flex-direction: column;
        text-align: center;
        padding: 24px 20px;
      }
      .join-btn {
        width: 100%;
        justify-content: center;
      }
      .gate-form {
        flex-direction: column;
      }
      .welcome-bar {
        flex-direction: column;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrap">

    <!-- Header -->
    <div class="header">
      <a href="index.html"><img src="assets/logo.svg" alt="Beyond Books" class="logo-img" /></a>
      <h1><span>My Classes</span></h1>
      <p>Access your Google Meet class link</p>
    </div>

    <!-- Access Code Gate -->
    <div class="gate" id="gate">
      <div class="gate-icon">&#128274;</div>
      <h2>Enter Your Access Code</h2>
      <p>Your unique code was shared on WhatsApp or email.<br>It looks like <strong style="color:#a78bfa;">BB7K2M9X</strong></p>
      <div class="gate-form">
        <input type="text" class="gate-input" id="codeInput" placeholder="BBXXXXXX" maxlength="8" autocomplete="off" />
        <button class="gate-btn" id="codeBtn">Enter</button>
      </div>
      <p class="gate-error" id="codeError"></p>
      <div class="help-link">
        <a href="https://wa.me/917416745454?text=Hi%2C%20I%20need%20my%20student%20access%20code%20for%20Beyond%20Books%20classes." target="_blank">Don't have a code? Message us on WhatsApp</a>
      </div>
    </div>

    <!-- Classes (shown after verification) -->
    <div class="classes" id="classes">

      <div class="welcome-bar">
        <div>
          <div class="welcome-text">Welcome, <strong id="studentName"></strong></div>
          <div class="welcome-code">Code: <span id="studentCode"></span></div>
        </div>
        <button class="logout-btn" id="logoutBtn">Lock Page</button>
      </div>

      <!-- Dynamic course card inserted here -->
      <div id="courseContainer"></div>

      <div class="info-note">
        <span>&#128161;</span>
        <div>
          <strong>Note:</strong> Join your class at the scheduled time shared on WhatsApp.
          If you have trouble joining, call us at <strong>7416745454</strong> or
          <a href="https://wa.me/917416745454" target="_blank" style="color: var(--primary-light);">message on WhatsApp</a>.
        </div>
      </div>

      <div class="page-footer">
        <p>&copy; 2026 Beyond Books. All rights reserved.</p>
        <p style="margin-top:6px;"><a href="index.html">&larr; Back to main website</a></p>
      </div>
    </div>

  </div>

  <script>
    // ===== YOUR GOOGLE APPS SCRIPT URL =====
    const API_URL = 'https://script.google.com/macros/s/AKfycbzMJCW8IJN81io6BwCVEcncFi-vRCDtB3RJ124kw1J1dfv7Hn4kd8PHNIR1l76HJ3dltg/exec';

    // Course icon + style mapping
    const COURSE_MAP = {
      'art & craft':     { icon: '&#127912;', css: 'art',    desc: 'Drawing, painting, origami & creative projects' },
      'chess':           { icon: '&#9823;',   css: 'chess',  desc: 'Strategy, critical thinking & problem solving' },
      'classical dance': { icon: '&#128131;', css: 'dance',  desc: 'Bharatanatyam, Kuchipudi & graceful movements' },
      'classical music': { icon: '&#127925;', css: 'music',  desc: 'Carnatic & Hindustani vocal training' },
      'abacus':          { icon: '&#129518;', css: 'abacus', desc: 'Mental math, speed & accuracy with numbers' }
    };

    const gate = document.getElementById('gate');
    const classes = document.getElementById('classes');
    const codeInput = document.getElementById('codeInput');
    const codeBtn = document.getElementById('codeBtn');
    const codeError = document.getElementById('codeError');
    const logoutBtn = document.getElementById('logoutBtn');
    const courseContainer = document.getElementById('courseContainer');
    const studentNameEl = document.getElementById('studentName');
    const studentCodeEl = document.getElementById('studentCode');

    function showError(msg) {
      codeError.textContent = msg;
      codeError.style.display = 'block';
      codeInput.style.borderColor = '#f87171';
      setTimeout(() => { codeInput.style.borderColor = ''; }, 2000);
    }

    function renderCourse(data) {
      const courseLower = data.course.toString().trim().toLowerCase();
      const info = COURSE_MAP[courseLower] || { icon: '&#128218;', css: 'art', desc: data.course };

      studentNameEl.textContent = data.name;
      studentCodeEl.textContent = sessionStorage.getItem('bb_code') || '';

      let html = '';
      if (data.meetLink) {
        html = `
          <div class="class-card">
            <div class="class-icon ${info.css}">${info.icon}</div>
            <div class="class-info">
              <h3>${data.course}</h3>
              <p>${info.desc}</p>
            </div>
            <a href="${data.meetLink}" class="join-btn" target="_blank">&#128247; Join Class</a>
          </div>`;
      } else {
        html = `
          <div class="class-card">
            <div class="class-icon ${info.css}">${info.icon}</div>
            <div class="class-info">
              <h3>${data.course}</h3>
              <p>${info.desc}</p>
            </div>
            <span class="join-btn" style="opacity:0.5;cursor:default;">Link coming soon</span>
          </div>`;
      }

      courseContainer.innerHTML = html;
    }

    async function verifyCode(code) {
      codeBtn.disabled = true;
      codeBtn.innerHTML = '<span class="spinner"></span>';
      codeError.style.display = 'none';

      try {
        const res = await fetch(API_URL + '?code=' + encodeURIComponent(code));
        const json = await res.json();

        if (json.status === 'success') {
          // Store in session
          sessionStorage.setItem('bb_code', code);
          sessionStorage.setItem('bb_data', JSON.stringify(json));

          // Show classes
          gate.style.display = 'none';
          classes.classList.add('visible');
          renderCourse(json);
        } else {
          showError(json.message === 'Invalid code'
            ? 'Invalid code. Check WhatsApp or contact us.'
            : json.message === 'Student not enrolled'
            ? 'Your enrollment is not active. Contact us on WhatsApp.'
            : 'Something went wrong. Please try again.');
        }
      } catch (err) {
        showError('Could not connect. Please check your internet and try again.');
      }

      codeBtn.disabled = false;
      codeBtn.textContent = 'Enter';
    }

    function lock() {
      gate.style.display = '';
      classes.classList.remove('visible');
      courseContainer.innerHTML = '';
      codeInput.value = '';
      codeError.style.display = 'none';
      sessionStorage.removeItem('bb_code');
      sessionStorage.removeItem('bb_data');
    }

    // Restore session
    const savedCode = sessionStorage.getItem('bb_code');
    const savedData = sessionStorage.getItem('bb_data');
    if (savedCode && savedData) {
      try {
        const data = JSON.parse(savedData);
        gate.style.display = 'none';
        classes.classList.add('visible');
        renderCourse(data);
      } catch (e) {
        lock();
      }
    }

    codeBtn.addEventListener('click', () => {
      const code = codeInput.value.trim().toUpperCase();
      if (!code) {
        showError('Please enter your access code.');
        return;
      }
      verifyCode(code);
    });

    codeInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') codeBtn.click();
    });

    logoutBtn.addEventListener('click', lock);
  </script>
</body>
</html>
